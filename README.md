# Luceam iOS 18.5

Luceam is a prototype social experience centered around creating short-lived "moments" of resonance. This repository contains an Xcode project with a basic SwiftUI app (`LuceamApp.swift`) that displays `ContentView` on launch.

The backend endpoints and flows mirror the original React/FastAPI prototype. An iOS implementation should consume these APIs to recreate the same behaviors.

## Project layout

- `Luceam/LuceamApp.swift` – Entry point that loads `ContentView`.
- `Luceam/ContentView.swift` – Main SwiftUI view listing moments and letting you create or join them.
- `Luceam/ContentView.swift` now includes a plus menu in the navigation bar for creating a new moment or a new mood room.
- `Luceam/Services/` – Simple API client, session and event stores, and WebSocket presence service.
- `LuceamTests/` and `LuceamUITests/` – Example test targets generated by Xcode.
- `Assets.xcassets/` – Image assets used by the app.

## Core backend API

The API is identical to the prototype's FastAPI backend. Highlights include:

- `POST /api/session` – create an anonymous session token.
- CRUD endpoints under `/api/events` for creating and listing moments.
- `WebSocket /ws/presence/{event_id}` – live participant count for events.
- Optional `/api/match` endpoint to retrieve random events.
- Premium endpoints `/api/resonance` and `/api/moodrooms` for resonance links and mood rooms.

## Expected user flow

1. **Launch the app** – call `POST /api/session` on first run and store the returned token.
2. **Browse moments** – display cards returned from `GET /api/events`.
3. **Create a moment** – open a modal, post to `POST /api/events`, and navigate to the new event's room.
4. **Join an energy room** – fetch event details and connect to `/ws/presence/{id}` to show live counts.
5. **Match with others** (optional) – call `/api/match` to get random moments from other sessions.
6. **Premium features** – after login/signup, allow creating resonance links and mood rooms, each with their WebSocket presence channels.

Mood definitions (animations, colors, ambient audio) should be loaded from the `public/moods` directory, matching the web prototype's configuration format.

## Running with Docker Compose

The repository includes a `docker-compose.yml` file that starts PostgreSQL,
Redis, and the NestJS backend. Bringing the stack up will also run the seeding
script so the database contains the default moments and mood rooms:

```bash
docker-compose up --build
```

After the services are up, the iOS app can interact with the API at
`http://localhost:3000`.

## Running tests

The project ships with placeholder unit and UI tests in `LuceamTests` and `LuceamUITests`. These can be executed from Xcode or via `xcodebuild` to validate the app once implemented.

### Launch performance metrics

UI tests normally measure launch performance with `XCTApplicationLaunchMetric`. Some simulator environments lack the system files needed for these metrics and emit errors like `load_eligibility_plist` during test runs. Metrics collection is therefore disabled by default. Set the environment variable `ENABLE_LAUNCH_METRICS=1` when running tests if you want to record launch metrics.

### Presence Simulation (Backend)

The backend can simulate participant counts for moments by writing synthetic
members into Redis. Enable the simulation and tune its behavior via the
following environment variables:

```
SIM_PRESENCE_ENABLED=true
SIM_PRESENCE_MIN=3
SIM_PRESENCE_MAX=19
SIM_PRESENCE_STEP_MS=4000
SIM_PRESENCE_RISE_RATIO=0.7
SIM_PRESENCE_DECAY_AFTER_MS=180000
SIM_PRESENCE_TTL_SECONDS=75
SIM_PRESENCE_MAX_DURATION_MS=600000
```

With the backend running, create a new moment through `POST /moments` and then
query `GET /moments/:id/presence`. The count will rise and decay based on the
configuration above and is also available via the WebSocket endpoint
`/ws/presence/:id`.


